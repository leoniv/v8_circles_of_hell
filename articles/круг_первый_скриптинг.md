# 1CV8 Кругов ада. Круг первый "1С - скриптинг"

> **Скриптинг** (scripting; от англ. script — сценарий) — написание сценариев (скриптов)
на интерпретируемых языках программирования. Как правило, использование термина скрипт
подразумевает автоматизацию рутинных операций, выполняемых в командной строке,
хотя это совсем не обязательно. [Источник](http://xgu.ru/wiki/Скриптинг)

## Проблема

Платформа 1С предоставляет богатый набор функций которые можно вызывать
используя интерфейс командной строки (далее CLI). **НО!** платформа 1C делает
это как всегда по своему, то-есть через известное место. Это обстоятельство
делает 1С скриптинг **ОЧЕНЬ** утомительным занятием, а сами скрипты ненадежными
звеньями в системе автоматизации рутинных задач администрирования и
сопровождения 1С.

## Что значит "по своему"?

А вот что:
- платформа 1С ничего не пишет в stdout и stderr и всегда выходит со статусом 0.
Для записи сообщений и статуса выхода, платформа 1С предлагает использовать
файлы, пути к которым принимает в CLI параметрах;
- платформа 1С не контролирует, явным образом, корректность поданного на вход
набора параметров и не сообщает нам об ошибке, а делает то, что считает нужным;
- платформа 1С может открывать GUI диалоги когда делать этого совсем не надо
так как _cron не умеет читать_;
- платформа 1С не выводит в консоль справку по CLI;

Ну и в завершении нельзя сказать о том, что платформа 1С имеет достаточно кривой
парсер CLI параметров. Ходя наметилась тенденция на его исправление, по
видимому, связанная с тем, что сама фирма 1С начала более активно использовать
свой-же CLI в своей разработке известной как EDT.

## Пример про параметры.

Все пункты, которые перечислены в разделе "по своему", не являются критичными за
исключением одного - пункта про корректность поданных на вход CLI параметров

Скажем вы пишете скрипт который должен дампить резервную копию
инфо-базы. Если вы ошибетесь с параметром `/DumpIB` и напишете `/DampIB` и
запустите `1cv8.exe` то платформа радостно откроет "Конфигуратор" считая, что
это именно то, что вы просили.

B это не самая проблемная ошибка т.к. вы обнаружите её в процессе создания и
отладки скрипта и рано или поздно вы поймете что делаете не так и пофиксите эту
ошибку.

## Пример про неожиданные GUI диалоги

Скажем вы пишете скрипт который должен запускать тонкого клиента, в котором
запускаются тесты из внешней обработки. Вы отладили ваш скрипт и задеплоили его
туда где его будет запускать cron по расписанию. И вот, в один прекрасный
момент, путь к инфо-базе в которой ваш скрипт запускает тесты, стал
некорректным. При возникновении подобных ситуаций, true-консольная программа
должна выругаться в stderr и выйти со статусом отличным от 0. В логе ошибок
скрипта должна появится запись (вы ведь знаете что значит строка `2>error.log`)
и вы будете знать что что-то пошло не так.

Однако 1С запущенная из терминала делает не так. Платформа откроет **GUI!**
окошко в котором сообщит (хз кому _cron то читать не умеет_) о том,
что "инфо-база не обнаружена но я могу её легко создать, если вы хотите". И будет
это процесс и это окошко висеть вечно т.к. _cron читать не умеет_ :)

## Решение

Единственным решением является контроль всего на свете на стороне скрипта т.к.
доверить это платформе нельзя. Другими словами фирма 1С как бы говорит нам:

> Е$итесь как хотите, главное  не забывайте [платить](articles/круг_второй_жлобство.md)
